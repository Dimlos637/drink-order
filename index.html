/* åœ¨ HTML çš„ <script> å€å¡Šæ›´æ–°é€™å¹¾æ®µæ ¸å¿ƒé‚è¼¯ */

let menuStore = [], extraStore = [], currentPrice = 0;

window.onload = () => {
    fetch(GAS_URL).then(res => res.json()).then(data => {
        document.getElementById('loading').style.display = 'none';
        if (data.status !== "é–‹å•Ÿ") { document.getElementById('closedSection').style.display = 'block'; return; }
        document.getElementById('formSection').style.display = 'block';
        document.getElementById('resTitle').innerText = "ğŸ¥¤ ä»Šæ—¥åº—å®¶ï¼š" + data.restaurant;
        
        menuStore = data.menu;
        extraStore = data.extras;

        // å¡«å……é£²å“é¸å–®
        const menuSelect = document.getElementById('menuSelect');
        menuSelect.add(new Option("-- è«‹é¸æ“‡é£²å“ --", ""));
        data.menu.forEach(row => { if(row[0]) menuSelect.add(new Option(`${row[0]} ($${row[1]})`, row[0])); });

        // å¡«å……åŠ æ–™é¸å–®
        const extraSelect = document.getElementById('extraSelect');
        data.extras.forEach(row => { 
            let opt = new Option(`${row[0]} (+$${row[1]})`, row[0]);
            opt.dataset.price = row[1];
            extraSelect.add(opt); 
        });
    });
};

function updateUI() {
    let qty = parseInt(document.getElementById('qtyInput').value) || 1;
    let extraOpt = document.getElementById('extraSelect').selectedOptions[0];
    let extraPrice = extraOpt ? parseFloat(extraOpt.dataset.price) : 0;
    
    // 50åµç‰¹æ®Šè¦å‰‡ï¼šå–®åƒ¹ > 35 åŠ æ–™å…è²»
    let isFree = currentPrice > 35 && extraPrice > 0;
    let finalExtraPrice = isFree ? 0 : extraPrice;
    let total = (currentPrice + finalExtraPrice) * qty;

    let detail = `å–®åƒ¹ $${currentPrice}`;
    if (extraPrice > 0) {
        detail += ` + åŠ æ–™ $${finalExtraPrice} ${isFree ? '<span class="text-success">(å…è²»)</span>' : ''}`;
    }
    document.getElementById('priceDisplay').innerHTML = `${detail} x ${qty} = ç¸½è¨ˆ <span class="price-tag">$${total}</span>`;
}
